
\begin{sstTitleBox}{
    MPC Mathematical Formulation
  }
  \begin{sstOnlyFrame}
    \begin{equation}
      \underset U\argmin
      \sum_{i=0}^{N-1} I(x_i,u_i) + I_f(x_N)
      \label{mpc:nominal}
    \end{equation}

    \vspace{-3mm}
    \begin{minipage}[t]{0.67\linewidth}
      \begin{align*}
        % TODO: better ordering formulation
        \textbf{Constraints}
        \quad
        x_0     & = x(k)            \\
        x_{i+1} & = f(x_i,u_i) \quad \text{linear case}: Ax_i + Bu_i      \\
        x_{i}   & \in \mathcal{X}   \\
        u_i     & \in \mathcal{U}   \\
        x_N     & \in \mathcal{X}_f
      \end{align*}
    \end{minipage}

    $I_f(\cdot)$ and $\mathcal{X}_f$
    are chosen to mimic an infinite horizon.
  \end{sstOnlyFrame}
\end{sstTitleBox}

What can go wrong with \textit{standard} MPC?

- No feasibility guarantee, the problem may not have a solution

- No stability guarantee, trajectories may not converge to  origin

%TODO: MPC Proof 1,2 L6.p31

\begin{sstTitleBox}[BrickRed]
  {  Stability of MPC - Main Result}

  \ssthl{\small\ Assumptions }
  \begin{sstOnlyFrame}[BrickRed]

    % TODO: extend MPC stability with math from ampc L2.24
    \ssthl{ 1 }
    Stage cost is
    strictly positive and only zero at the origin

    \ssthl{ 2 }
    Terminal set is \textbf{invariant}
    under local control law $\kappa_f(x_i)$:
    \[
      x_{i+1} = Ax_i + B\kappa_f(x_i) \in \mathcal{X}_f
      \ \ \text\forall\  x_i \in \mathcal{X}_f
    \]

    \quad All state and input \textbf{constraints are satisfied} in
    $\mathcal{X}_f$:
    \[
      \mathcal{X}_f \in X, \kappa_f(x_i) \in U
      \ \ \forall\  x_i \in \mathcal{X}_f
    \]

    \ssthl{ 3 }
    Terminal cost is a continuous
    \textbf{Lyapunov function} s.t.
    \[
      l_f(x_{i+1}) - l_f(x_i) \leq
      - l(x_i, \kappa_f(x_i)) \quad
      \forall x_i \in \mathcal{X}_f
    \]
  \end{sstOnlyFrame}
  \begin{sstOnlyFrame}[BrickRed]
    \begin{theorem}
      Under the previous assumptions, the closed-loop system under
      the MPC control law $u_0^\star(x)$
      is asymptotically stable and the set $\mathcal{X}_f$
      is positive invariant for
      \[
        x(k+1) = Ax(k) + Bu_0^\star(x(k))
      \]
    \end{theorem}
  \end{sstOnlyFrame}
\end{sstTitleBox}

\textbf{Finite-horizon MPC may not satisfy constraints for all time!}

\textbf{Finite-horizon MPC may not be stable!}

-  An infinite-horizon provides stability and invariance.

-  Infinite-horizon \textit{faked} by forcing final state
into an invariant set for which there exists
invariance-inducing controller,
whose infinite-horizon cost can be expressed in closed-form.

-  Extends to non-linear systems, but compute sets is difficult!

% HACK: Stability and Recursive feasibility of MPC - Outline of the proof

